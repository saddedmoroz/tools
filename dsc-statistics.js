// ==UserScript==
// @name			DSC: статистика
// @version			2.0
// @description		23-12-2024
// @updateURL		https://raw.githubusercontent.com/saddedmoroz/tools/master/dsc-statistics.js
// @downloadURL		https://raw.githubusercontent.com/saddedmoroz/tools/master/dsc-statistics.js
// @author			saddedmoroz
// @match			https://centiman.avito.ru/service-dataset-collector-frontend/*
// ==/UserScript==

/*
	Отображает статистику в верхней панели.
	При клике по названию показатель будет сброшен на 0.
	При клике по времени будет скрыт встроенный счётчик.
	При возникновении ошибок попробовать нажать Выход в правом верхнем углу и войти заново.
*/

'use strict';

function _0x30d1(_0xf94043,_0x20f839){const _0x59e22d=_0x59e2();return _0x30d1=function(_0x30d1cd,_0x159bfc){_0x30d1cd=_0x30d1cd-0x98;let _0x4f1088=_0x59e22d[_0x30d1cd];return _0x4f1088;},_0x30d1(_0xf94043,_0x20f839);}const _0x11c1ed=_0x30d1;(function(_0x419dea,_0x27c679){const _0x2c6296=_0x30d1,_0x3f4c1c=_0x419dea();while(!![]){try{const _0x24e580=-parseInt(_0x2c6296(0x9e))/0x1*(parseInt(_0x2c6296(0xbc))/0x2)+parseInt(_0x2c6296(0xc9))/0x3*(parseInt(_0x2c6296(0xc0))/0x4)+-parseInt(_0x2c6296(0xa3))/0x5*(parseInt(_0x2c6296(0x9f))/0x6)+-parseInt(_0x2c6296(0xa1))/0x7*(-parseInt(_0x2c6296(0xd2))/0x8)+parseInt(_0x2c6296(0xca))/0x9+-parseInt(_0x2c6296(0xd0))/0xa+-parseInt(_0x2c6296(0xb3))/0xb*(-parseInt(_0x2c6296(0xaa))/0xc);if(_0x24e580===_0x27c679)break;else _0x3f4c1c['push'](_0x3f4c1c['shift']());}catch(_0x2db726){_0x3f4c1c['push'](_0x3f4c1c['shift']());}}}(_0x59e2,0x87c06));let g_stat,g_stat_list=[],g_elm_time_now,g_elm_total,g_elm_cph_past,g_elm_cph_now;const g_dt_now=new Date(),g_obs_job_close=new MutationObserver(ObserveJobClose);function _0x59e2(){const _0x3b6754=['push','btn-reset-cph','40151HxCFEc','5744976jBpftP','#app\x20>\x20main\x20>\x20div\x20>\x20div:nth-child(2)','105Ebmuli','time-now','5kbZsGt','match','count-per-hour','setItem','querySelector','disconnect','display','9692556RVirzf','hour','insertAdjacentHTML','textContent','btn-reset-cph-past','target','stringify','getElementById','querySelectorAll','33GebzRs','Observer:\x20','cphPast','нет\x20объекта','count-per-hour-past','addEventListener','href','btn-reset-total','prjName','50efEfUa','toLocaleTimeString','toString','getItem','268MUjwlh','warn','incrementCounters','length','cphNow','Готово','parse','afterend','message','20253HssAnz','4401594HcPguw','now','TimerInit:\x20','total','setTime','observe','8820130rEOQmt','header\x20>\x20div:nth-child(1)','18560kcBcBp','div.stats','none','style','dsc-s','click'];_0x59e2=function(){return _0x3b6754;};return _0x59e2();}class PrjStat{#prjName;#keyName;#stat;#date=new Date();constructor(_0x2c5ba3){const _0xba92e8=_0x30d1;this.#prjName=_0x2c5ba3[_0xba92e8(0xbe)](),this.#keyName='stat-'+this.#prjName;const _0x3b678d=this.#getNowHour(),_0x4f0a94=localStorage[_0xba92e8(0xbf)](this.#keyName);Boolean(_0x4f0a94)?(this.#stat=JSON[_0xba92e8(0xc6)](_0x4f0a94),this.#stat[_0xba92e8(0xab)]!=_0x3b678d&&(this.#stat[_0xba92e8(0xab)]=_0x3b678d,this.#stat[_0xba92e8(0xb5)]=this.#stat[_0xba92e8(0xc4)],this.#stat[_0xba92e8(0xc4)]=0x0,this.#saveStorage())):(this.#stat={'total':0x0,'cphPast':0x0,'cphNow':0x0,'hour':_0x3b678d},this.#saveStorage());}#saveStorage(){const _0x3be2db=_0x30d1;localStorage[_0x3be2db(0xa6)](this.#keyName,JSON[_0x3be2db(0xb0)](this.#stat));}#getNowHour(){const _0x1350c0=_0x30d1;return this.#date[_0x1350c0(0xce)](Date[_0x1350c0(0xcb)]()),this.#date['getHours']();}[_0x11c1ed(0xc2)](){const _0x265668=_0x11c1ed,_0x319a85=this.#getNowHour();this.#stat['hour']!=_0x319a85?(this.#stat[_0x265668(0xab)]=_0x319a85,this.#stat[_0x265668(0xb5)]=this.#stat[_0x265668(0xc4)],this.#stat[_0x265668(0xc4)]=0x1):(this.#stat[_0x265668(0xcd)]+=0x1,this.#stat[_0x265668(0xc4)]+=0x1),this.#saveStorage();}get[_0x11c1ed(0xcd)](){return this.#stat['total']['toString']();}get['cphPast'](){const _0x3254c8=_0x11c1ed;return this.#stat[_0x3254c8(0xb5)][_0x3254c8(0xbe)]();}get[_0x11c1ed(0xc4)](){const _0x5321ef=_0x11c1ed;return this.#stat[_0x5321ef(0xc4)][_0x5321ef(0xbe)]();}get[_0x11c1ed(0xbb)](){return this.#prjName;}set[_0x11c1ed(0xcd)](_0x2be743){const _0x5853f3=_0x11c1ed;this.#stat[_0x5853f3(0xcd)]=parseInt(_0x2be743),this.#saveStorage();}set['cphPast'](_0x4993ce){const _0x5c5889=_0x11c1ed;this.#stat[_0x5c5889(0xb5)]=parseInt(_0x4993ce),this.#saveStorage();}set[_0x11c1ed(0xc4)](_0x44a3fa){const _0x4bd47f=_0x11c1ed;this.#stat[_0x4bd47f(0xc4)]=parseInt(_0x44a3fa),this.#saveStorage();}}const timerInit=setInterval(()=>{const _0x241531=_0x11c1ed;try{if(!Boolean(document['getElementById'](_0x241531(0x9a)))){let _0x3e3178=document[_0x241531(0xa7)](_0x241531(0xd1));if(!Boolean(_0x3e3178))return;_0x3e3178[_0x241531(0xac)](_0x241531(0xc7),'<div\x20id=\x22dsc-s\x22\x20style=\x22color:\x20#f8f8ff;\x20display:\x20inline-block;\x20font-family:\x20monospace;\x22><span\x20id=\x22time-now\x22\x20title=\x22Кликни\x20чтобы\x20показать\x20или\x20скрыть\x0aвстроенный\x20счётчик\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-total\x22\x20title=\x22Кликни\x20чтобы\x20сбросить\x20этот\x20счётчик\x22>Итого:\x20</span><span\x20id=\x22total\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-cph-past\x22\x20title=\x22Предыдущие\x20показания\x0aсчётчика\x20ТЧ\x22>ПП:\x20</span><span\x20id=\x22count-per-hour-past\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-cph\x22\x20title=\x22Сколько\x20сделано\x0aза\x20текущий\x20час\x22>ТЧ:\x20</span><span\x20id=\x22count-per-hour\x22>?</span></div>'),_0x3e3178=document[_0x241531(0xb1)](_0x241531(0xa2)),_0x3e3178[_0x241531(0xb8)]('click',()=>{const _0x187a13=_0x241531,_0x2816e5=document['querySelector'](_0x187a13(0xd3));if(Boolean(_0x2816e5))_0x2816e5[_0x187a13(0x99)][_0x187a13(0xa9)]=_0x2816e5[_0x187a13(0x99)][_0x187a13(0xa9)]==''?_0x187a13(0x98):'';}),_0x3e3178=document[_0x241531(0xb1)](_0x241531(0xba)),_0x3e3178['addEventListener'](_0x241531(0x9b),()=>{const _0x3f6b8b=_0x241531;g_stat[_0x3f6b8b(0xcd)]=0x0;}),_0x3e3178=document[_0x241531(0xb1)](_0x241531(0xae)),_0x3e3178['addEventListener']('click',()=>{const _0x1f8629=_0x241531;g_stat[_0x1f8629(0xb5)]=0x0;}),_0x3e3178=document[_0x241531(0xb1)](_0x241531(0x9d)),_0x3e3178[_0x241531(0xb8)](_0x241531(0x9b),()=>{const _0x359217=_0x241531;g_stat[_0x359217(0xc4)]=0x0;}),g_elm_time_now=document['getElementById'](_0x241531(0xa2)),g_elm_total=document['getElementById'](_0x241531(0xcd)),g_elm_cph_past=document[_0x241531(0xb1)](_0x241531(0xb7)),g_elm_cph_now=document[_0x241531(0xb1)](_0x241531(0xa5)),clearInterval(timerInit),setInterval(TimerStat,0x3e8);}}catch(_0x255f10){console['warn'](_0x241531(0xcc)+_0x255f10['message']),clearInterval(timerInit);}},0x3e8);document['addEventListener'](_0x11c1ed(0x9b),_0x1a3d87=>{const _0x2b5afe=_0x11c1ed;try{const _0xc16e79=document[_0x2b5afe(0xb2)]('button.el-button');let _0x43d596=_0xc16e79[_0x2b5afe(0xc3)];while(_0x43d596--){const _0x11b3fd=_0xc16e79[_0x43d596];if(Boolean(_0x11b3fd[_0x2b5afe(0xad)]['includes'](_0x2b5afe(0xc5)))){if(_0x11b3fd['contains'](_0x1a3d87[_0x2b5afe(0xaf)])){const _0x3f6b39=document[_0x2b5afe(0xa7)](_0x2b5afe(0xa0));if(!Boolean(_0x3f6b39))throw new Error(_0x2b5afe(0xb6));g_obs_job_close[_0x2b5afe(0xcf)](_0x3f6b39,{'childList':!![]});break;}}}}catch(_0x4c323a){console[_0x2b5afe(0xc1)]('Click:\x20'+_0x4c323a[_0x2b5afe(0xc8)]);}});function ObserveJobClose(){const _0x47cbee=_0x11c1ed;try{g_stat['incrementCounters']();}catch(_0x4675f3){console[_0x47cbee(0xc1)](_0x47cbee(0xb4)+_0x4675f3[_0x47cbee(0xc8)]);}finally{g_obs_job_close[_0x47cbee(0xa8)]();}}function LoadPrjStat(){const _0x517276=_0x11c1ed;let _0x7eb0e4=window['location'][_0x517276(0xb9)][_0x517276(0xa4)](/(?<=\/service-dataset-collector-frontend\/project\/)\d+/);if(!Boolean(_0x7eb0e4))return![];_0x7eb0e4=_0x7eb0e4[0x0];if(Boolean(g_stat)){if(_0x7eb0e4==g_stat[_0x517276(0xbb)])return!![];let _0x47e747=g_stat_list[_0x517276(0xc3)];while(_0x47e747--){if(g_stat_list[_0x47e747][_0x517276(0xbb)]==_0x7eb0e4)return g_stat=g_stat_list[_0x47e747],!![];}}return g_stat=new PrjStat(_0x7eb0e4),g_stat_list[_0x517276(0x9c)](g_stat),!![];}function TimerStat(){const _0x2fe56d=_0x11c1ed;g_dt_now[_0x2fe56d(0xce)](Date['now']()),g_elm_time_now[_0x2fe56d(0xad)]=g_dt_now[_0x2fe56d(0xbd)]();if(!LoadPrjStat()){g_elm_total[_0x2fe56d(0xad)]=g_elm_cph_past[_0x2fe56d(0xad)]=g_elm_cph_now[_0x2fe56d(0xad)]='?';return;}g_elm_total[_0x2fe56d(0xad)]=g_stat[_0x2fe56d(0xcd)],g_elm_cph_past[_0x2fe56d(0xad)]=g_stat[_0x2fe56d(0xb5)],g_elm_cph_now[_0x2fe56d(0xad)]=g_stat[_0x2fe56d(0xc4)];}
