// ==UserScript==
// @name			DSC: статистика
// @version			2.1
// @description		05-03-2025
// @updateURL		https://raw.githubusercontent.com/saddedmoroz/tools/master/dsc-statistics.js
// @downloadURL		https://raw.githubusercontent.com/saddedmoroz/tools/master/dsc-statistics.js
// @author			saddedmoroz
// @match			https://centiman.avito.ru/service-dataset-collector-frontend/*
// ==/UserScript==

/*
	Отображает статистику в верхней панели.
	При клике по названию показатель будет сброшен на 0.
	При клике по времени будет скрыт встроенный счётчик.
	При возникновении ошибок попробовать выйти из учетной записи и авторизоваться заново.
*/

'use strict';

const _0x371bb3=_0x3fcf;(function(_0x35b9f7,_0x13af5f){const _0x31a19e=_0x3fcf,_0x2c44d9=_0x35b9f7();while(!![]){try{const _0x2a520f=parseInt(_0x31a19e(0x94))/0x1+-parseInt(_0x31a19e(0x8d))/0x2+-parseInt(_0x31a19e(0xaa))/0x3*(parseInt(_0x31a19e(0x98))/0x4)+parseInt(_0x31a19e(0x97))/0x5+parseInt(_0x31a19e(0xba))/0x6+-parseInt(_0x31a19e(0xa3))/0x7+parseInt(_0x31a19e(0xb1))/0x8;if(_0x2a520f===_0x13af5f)break;else _0x2c44d9['push'](_0x2c44d9['shift']());}catch(_0x171935){_0x2c44d9['push'](_0x2c44d9['shift']());}}}(_0x2ed9,0xe864e));let g_stat,g_stat_list=[],g_elm_time_now,g_elm_total,g_elm_cph_past,g_elm_cph_now;const g_dt_now=new Date(),g_obs_job_close=new MutationObserver(ObserveJobClose);class PrjStat{#prjName;#keyName;#stat;#date=new Date();constructor(_0x58ae4c){const _0x23981d=_0x3fcf;this.#prjName=_0x58ae4c['toString'](),this.#keyName='stat-'+this.#prjName;const _0x4cafd8=this.#getNowHour(),_0x47ed24=localStorage[_0x23981d(0x8e)](this.#keyName);Boolean(_0x47ed24)?(this.#stat=JSON[_0x23981d(0xa4)](_0x47ed24),this.#stat['hour']!=_0x4cafd8&&(this.#stat[_0x23981d(0x91)]=_0x4cafd8,this.#stat[_0x23981d(0xbf)]=this.#stat['cphNow'],this.#stat['cphNow']=0x0,this.#saveStorage())):(this.#stat={'total':0x0,'cphPast':0x0,'cphNow':0x0,'hour':_0x4cafd8},this.#saveStorage());}#saveStorage(){const _0x1f9cb=_0x3fcf;localStorage[_0x1f9cb(0x9b)](this.#keyName,JSON[_0x1f9cb(0xb0)](this.#stat));}#getNowHour(){const _0x1e76fa=_0x3fcf;return this.#date[_0x1e76fa(0x92)](Date['now']()),this.#date[_0x1e76fa(0xa2)]();}['incrementCounters'](){const _0x522e66=_0x3fcf,_0x40a119=this.#getNowHour();this.#stat[_0x522e66(0x91)]!=_0x40a119?(this.#stat[_0x522e66(0x91)]=_0x40a119,this.#stat[_0x522e66(0xbf)]=this.#stat[_0x522e66(0xb6)],this.#stat[_0x522e66(0xb6)]=0x1):(this.#stat[_0x522e66(0xa7)]+=0x1,this.#stat['cphNow']+=0x1),this.#saveStorage();}get[_0x371bb3(0xa7)](){const _0x3b3640=_0x371bb3;return this.#stat[_0x3b3640(0xa7)][_0x3b3640(0x96)]();}get['cphPast'](){const _0x2915bd=_0x371bb3;return this.#stat['cphPast'][_0x2915bd(0x96)]();}get[_0x371bb3(0xb6)](){const _0x449448=_0x371bb3;return this.#stat[_0x449448(0xb6)][_0x449448(0x96)]();}get[_0x371bb3(0xa6)](){return this.#prjName;}set[_0x371bb3(0xa7)](_0x17c5e8){const _0x10c811=_0x371bb3;this.#stat[_0x10c811(0xa7)]=parseInt(_0x17c5e8),this.#saveStorage();}set['cphPast'](_0x783bc){const _0x2ea75b=_0x371bb3;this.#stat[_0x2ea75b(0xbf)]=parseInt(_0x783bc),this.#saveStorage();}set[_0x371bb3(0xb6)](_0x4d4a28){const _0x1155dd=_0x371bb3;this.#stat[_0x1155dd(0xb6)]=parseInt(_0x4d4a28),this.#saveStorage();}}function _0x3fcf(_0x2687ec,_0x3702f5){const _0x2ed950=_0x2ed9();return _0x3fcf=function(_0x3fcf83,_0x4831bc){_0x3fcf83=_0x3fcf83-0x89;let _0x34ebc1=_0x2ed950[_0x3fcf83];return _0x34ebc1;},_0x3fcf(_0x2687ec,_0x3702f5);}const timerInit=setInterval(()=>{const _0x28378a=_0x371bb3;try{if(!Boolean(document[_0x28378a(0xb9)](_0x28378a(0x8a)))){let _0x3f9621=document['querySelector']('header\x20>\x20ul');if(!Boolean(_0x3f9621))return;_0x3f9621['insertAdjacentHTML'](_0x28378a(0x8b),_0x28378a(0x9a)),_0x3f9621=document['getElementById'](_0x28378a(0xb8)),_0x3f9621[_0x28378a(0xaf)]('click',()=>{const _0xbafa6a=_0x28378a,_0xb22cec=document[_0xbafa6a(0xa1)]('div.stats');if(Boolean(_0xb22cec))_0xb22cec[_0xbafa6a(0xb2)][_0xbafa6a(0x8c)]=_0xb22cec['style']['display']==''?_0xbafa6a(0xbe):'';}),_0x3f9621=document[_0x28378a(0xb9)](_0x28378a(0xb3)),_0x3f9621[_0x28378a(0xaf)](_0x28378a(0xb7),()=>{g_stat['total']=0x0;}),_0x3f9621=document[_0x28378a(0xb9)]('btn-reset-cph-past'),_0x3f9621[_0x28378a(0xaf)](_0x28378a(0xb7),()=>{const _0x19e3e6=_0x28378a;g_stat[_0x19e3e6(0xbf)]=0x0;}),_0x3f9621=document[_0x28378a(0xb9)](_0x28378a(0xa8)),_0x3f9621[_0x28378a(0xaf)](_0x28378a(0xb7),()=>{g_stat['cphNow']=0x0;}),g_elm_time_now=document[_0x28378a(0xb9)](_0x28378a(0xb8)),g_elm_total=document['getElementById'](_0x28378a(0xa7)),g_elm_cph_past=document[_0x28378a(0xb9)](_0x28378a(0xa5)),g_elm_cph_now=document[_0x28378a(0xb9)](_0x28378a(0x8f)),clearInterval(timerInit),setInterval(TimerStat,0x3e8);}}catch(_0x2cf847){console['warn'](_0x28378a(0xb5)+_0x2cf847[_0x28378a(0xad)]),clearInterval(timerInit);}},0x3e8);document[_0x371bb3(0xaf)](_0x371bb3(0xb7),_0x57bd9b=>{const _0x452f5f=_0x371bb3;try{const _0x4e4823=document[_0x452f5f(0x95)](_0x452f5f(0xa0));let _0x4be755=_0x4e4823[_0x452f5f(0x90)];while(_0x4be755--){const _0x1c6c22=_0x4e4823[_0x4be755];if(Boolean(_0x1c6c22[_0x452f5f(0x99)][_0x452f5f(0xab)](_0x452f5f(0xbc)))){if(_0x1c6c22['contains'](_0x57bd9b['target'])){const _0x51f43a=document['querySelector']('#app\x20>\x20main\x20>\x20div\x20>\x20div:nth-child(2)');if(!Boolean(_0x51f43a))throw new Error(_0x452f5f(0xbd));g_obs_job_close[_0x452f5f(0xa9)](_0x51f43a,{'childList':!![]});break;}}}}catch(_0x196838){console[_0x452f5f(0x93)](_0x452f5f(0x9c)+_0x196838[_0x452f5f(0xad)]);}});function ObserveJobClose(){const _0x16be0f=_0x371bb3;try{g_stat['incrementCounters']();}catch(_0x2ce387){console[_0x16be0f(0x93)](_0x16be0f(0xb4)+_0x2ce387[_0x16be0f(0xad)]);}finally{g_obs_job_close[_0x16be0f(0xac)]();}}function LoadPrjStat(){const _0x42fdc5=_0x371bb3;let _0x103347=window[_0x42fdc5(0xbb)][_0x42fdc5(0x9d)][_0x42fdc5(0x9e)](/(?<=\/service-dataset-collector-frontend\/project\/)\d+/);if(!Boolean(_0x103347))return![];_0x103347=_0x103347[0x0];if(Boolean(g_stat)){if(_0x103347==g_stat['prjName'])return!![];let _0x4b257e=g_stat_list['length'];while(_0x4b257e--){if(g_stat_list[_0x4b257e][_0x42fdc5(0xa6)]==_0x103347)return g_stat=g_stat_list[_0x4b257e],!![];}}return g_stat=new PrjStat(_0x103347),g_stat_list[_0x42fdc5(0x9f)](g_stat),!![];}function _0x2ed9(){const _0x351778=['button.el-button','querySelector','getHours','9777684bymOQz','parse','count-per-hour-past','prjName','total','btn-reset-cph','observe','789fWxVSZ','includes','disconnect','message','toLocaleTimeString','addEventListener','stringify','21282816uXaZnT','style','btn-reset-total','Observer:\x20','TimerInit:\x20','cphNow','click','time-now','getElementById','1309476wwquHB','location','Готово','нет\x20объекта','none','cphPast','now','dsc-s','beforebegin','display','647844SXrCge','getItem','count-per-hour','length','hour','setTime','warn','1020105oYadea','querySelectorAll','toString','1109975PdjhoH','22024YGDKBN','textContent','<div\x20id=\x22dsc-s\x22\x20style=\x22color:\x20#f8f8ff;\x20display:\x20inline-block;\x20font-family:\x20monospace;\x20width:\x2036em;\x22><span\x20id=\x22time-now\x22\x20title=\x22Кликни\x20чтобы\x20показать\x20или\x20скрыть\x0aвстроенный\x20счётчик\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-total\x22\x20title=\x22Кликни\x20чтобы\x20сбросить\x20этот\x20счётчик\x22>Итого:\x20</span><span\x20id=\x22total\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-cph-past\x22\x20title=\x22Предыдущие\x20показания\x0aсчётчика\x20ТЧ\x22>ПП:\x20</span><span\x20id=\x22count-per-hour-past\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-cph\x22\x20title=\x22Сколько\x20сделано\x0aза\x20текущий\x20час\x22>ТЧ:\x20</span><span\x20id=\x22count-per-hour\x22>?</span></div>','setItem','Click:\x20','href','match','push'];_0x2ed9=function(){return _0x351778;};return _0x2ed9();}function TimerStat(){const _0x4bfd8e=_0x371bb3;g_dt_now[_0x4bfd8e(0x92)](Date[_0x4bfd8e(0x89)]()),g_elm_time_now['textContent']=g_dt_now[_0x4bfd8e(0xae)]();if(!LoadPrjStat()){g_elm_total[_0x4bfd8e(0x99)]=g_elm_cph_past[_0x4bfd8e(0x99)]=g_elm_cph_now[_0x4bfd8e(0x99)]='?';return;}g_elm_total[_0x4bfd8e(0x99)]=g_stat['total'],g_elm_cph_past[_0x4bfd8e(0x99)]=g_stat[_0x4bfd8e(0xbf)],g_elm_cph_now[_0x4bfd8e(0x99)]=g_stat['cphNow'];}
