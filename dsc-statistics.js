// ==UserScript==
// @name			DSC: статистика
// @version			2.2
// @description		07-03-2025
// @updateURL		https://raw.githubusercontent.com/saddedmoroz/tools/refs/heads/master/dsc-statistics.js
// @downloadURL		https://raw.githubusercontent.com/saddedmoroz/tools/refs/heads/master/dsc-statistics.js
// @author			saddedmoroz
// @match			https://centiman.avito.ru/service-dataset-collector-frontend/*
// ==/UserScript==

/*
	Отображает статистику в верхней панели.
	При клике по времени будет скрыт/показан встроенный счётчик.
	При клике по названию показателя Итого, ПП, ТЧ он будет сброшен на 0.
	При возникновении ошибок попробовать выйти из учетной записи и авторизоваться заново.
*/

'use strict';

const _0x5bfb4d=_0xf224;(function(_0x153613,_0x427f82){const _0x38997c=_0xf224,_0x36fc59=_0x153613();while(!![]){try{const _0x3163c4=parseInt(_0x38997c(0xc9))/0x1*(-parseInt(_0x38997c(0xba))/0x2)+parseInt(_0x38997c(0xdb))/0x3*(parseInt(_0x38997c(0xe4))/0x4)+parseInt(_0x38997c(0xc6))/0x5*(-parseInt(_0x38997c(0xd4))/0x6)+-parseInt(_0x38997c(0xbb))/0x7*(-parseInt(_0x38997c(0xc2))/0x8)+-parseInt(_0x38997c(0xcc))/0x9+-parseInt(_0x38997c(0xc3))/0xa*(parseInt(_0x38997c(0xd8))/0xb)+parseInt(_0x38997c(0xc1))/0xc*(parseInt(_0x38997c(0xdd))/0xd);if(_0x3163c4===_0x427f82)break;else _0x36fc59['push'](_0x36fc59['shift']());}catch(_0x590895){_0x36fc59['push'](_0x36fc59['shift']());}}}(_0x352b,0xbdcec));function _0x352b(){const _0x8230bf=['TimerInit:\x20','91322bPohDN','push','target','3vyYjzn','btn-reset-cph-past','360386xEkJvS','addEventListener','click','querySelectorAll','cphNow','setTime','now','2677568fFIkJw','Готово','Observer:\x20','stat-','hour','cphPast','count-per-hour-past','time-now','button.el-button','message','btn-reset-cph','none','prjName','textContent','contains','querySelector','location','498uWhDAj','4269517DtKRCo','includes','match','href','setItem','length','984ZKeAoe','16TZrymK','610abOFQV','style','getHours','11065DWKfxr','нет\x20объекта','display','6181DQkRxg','getItem','total','10840698eQocWz','toLocaleTimeString','incrementCounters','<div\x20id=\x22dsc-s\x22\x20style=\x22color:\x20#f8f8ff;\x20display:\x20inline-block;\x20font-family:\x20monospace;\x20min-width:\x20fit-content;\x20padding-right:\x202em;\x22><span\x20id=\x22time-now\x22\x20title=\x22Кликни\x20чтобы\x20показать\x20или\x20скрыть\x0aвстроенный\x20счётчик\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-total\x22\x20title=\x22Кликни\x20чтобы\x20сбросить\x20этот\x20счётчик\x22>Итого:\x20</span><span\x20id=\x22total\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-cph-past\x22\x20title=\x22Предыдущие\x20показания\x0aсчётчика\x20ТЧ\x22>ПП:\x20</span><span\x20id=\x22count-per-hour-past\x22\x20style=\x22padding-right:\x202em;\x22>?</span><span\x20id=\x22btn-reset-cph\x22\x20title=\x22Сколько\x20сделано\x0aза\x20текущий\x20час\x22>ТЧ:\x20</span><span\x20id=\x22count-per-hour\x22>?</span></div>','warn','observe','div.stats','count-per-hour','366WroGnY','getElementById','toString'];_0x352b=function(){return _0x8230bf;};return _0x352b();}let g_stat,g_stat_list=[],g_elm_time_now,g_elm_total,g_elm_cph_past,g_elm_cph_now;const g_dt_now=new Date(),g_obs_job_close=new MutationObserver(ObserveJobClose);function _0xf224(_0x52c9a5,_0x15ce22){const _0x352b86=_0x352b();return _0xf224=function(_0xf2243,_0x1cd930){_0xf2243=_0xf2243-0xb8;let _0xdd6940=_0x352b86[_0xf2243];return _0xdd6940;},_0xf224(_0x52c9a5,_0x15ce22);}class PrjStat{#prjName;#keyName;#stat;#date=new Date();constructor(_0xd7a915){const _0x58d089=_0xf224;this.#prjName=_0xd7a915[_0x58d089(0xd6)](),this.#keyName=_0x58d089(0xe7)+this.#prjName;const _0x49d907=this.#getNowHour(),_0x5e508b=localStorage[_0x58d089(0xca)](this.#keyName);Boolean(_0x5e508b)?(this.#stat=JSON['parse'](_0x5e508b),this.#stat[_0x58d089(0xe8)]!=_0x49d907&&(this.#stat[_0x58d089(0xe8)]=_0x49d907,this.#stat[_0x58d089(0xe9)]=this.#stat[_0x58d089(0xe1)],this.#stat[_0x58d089(0xe1)]=0x0,this.#saveStorage())):(this.#stat={'total':0x0,'cphPast':0x0,'cphNow':0x0,'hour':_0x49d907},this.#saveStorage());}#saveStorage(){const _0x3f2e5f=_0xf224;localStorage[_0x3f2e5f(0xbf)](this.#keyName,JSON['stringify'](this.#stat));}#getNowHour(){const _0x48f7f3=_0xf224;return this.#date[_0x48f7f3(0xe2)](Date['now']()),this.#date[_0x48f7f3(0xc5)]();}[_0x5bfb4d(0xce)](){const _0x5a7c95=_0x5bfb4d,_0x20fd5c=this.#getNowHour();this.#stat[_0x5a7c95(0xe8)]!=_0x20fd5c?(this.#stat[_0x5a7c95(0xe8)]=_0x20fd5c,this.#stat['cphPast']=this.#stat[_0x5a7c95(0xe1)],this.#stat[_0x5a7c95(0xe1)]=0x1):(this.#stat['total']+=0x1,this.#stat[_0x5a7c95(0xe1)]+=0x1),this.#saveStorage();}get['total'](){const _0x5b1949=_0x5bfb4d;return this.#stat[_0x5b1949(0xcb)]['toString']();}get[_0x5bfb4d(0xe9)](){const _0x50a908=_0x5bfb4d;return this.#stat[_0x50a908(0xe9)][_0x50a908(0xd6)]();}get[_0x5bfb4d(0xe1)](){const _0x24e8a5=_0x5bfb4d;return this.#stat[_0x24e8a5(0xe1)][_0x24e8a5(0xd6)]();}get[_0x5bfb4d(0xf0)](){return this.#prjName;}set[_0x5bfb4d(0xcb)](_0x3fe26d){const _0xb8cb51=_0x5bfb4d;this.#stat[_0xb8cb51(0xcb)]=parseInt(_0x3fe26d),this.#saveStorage();}set[_0x5bfb4d(0xe9)](_0x2f326d){const _0x8570a1=_0x5bfb4d;this.#stat[_0x8570a1(0xe9)]=parseInt(_0x2f326d),this.#saveStorage();}set[_0x5bfb4d(0xe1)](_0x531ce3){this.#stat['cphNow']=parseInt(_0x531ce3),this.#saveStorage();}}const timerInit=setInterval(()=>{const _0x45302b=_0x5bfb4d;try{if(!Boolean(document['getElementById']('dsc-s'))){let _0x1fa6ec=document[_0x45302b(0xb8)]('header\x20>\x20ul');if(!Boolean(_0x1fa6ec))return;_0x1fa6ec['insertAdjacentHTML']('beforebegin',_0x45302b(0xcf)),_0x1fa6ec=document[_0x45302b(0xd5)](_0x45302b(0xeb)),_0x1fa6ec['addEventListener']('click',()=>{const _0x9ac362=_0x45302b,_0xdacdc9=document[_0x9ac362(0xb8)](_0x9ac362(0xd2));if(Boolean(_0xdacdc9))_0xdacdc9[_0x9ac362(0xc4)][_0x9ac362(0xc8)]=_0xdacdc9[_0x9ac362(0xc4)][_0x9ac362(0xc8)]==''?_0x9ac362(0xef):'';}),_0x1fa6ec=document['getElementById']('btn-reset-total'),_0x1fa6ec[_0x45302b(0xde)](_0x45302b(0xdf),()=>{const _0x589b9c=_0x45302b;g_stat[_0x589b9c(0xcb)]=0x0;}),_0x1fa6ec=document['getElementById'](_0x45302b(0xdc)),_0x1fa6ec[_0x45302b(0xde)](_0x45302b(0xdf),()=>{const _0x2389ec=_0x45302b;g_stat[_0x2389ec(0xe9)]=0x0;}),_0x1fa6ec=document[_0x45302b(0xd5)](_0x45302b(0xee)),_0x1fa6ec['addEventListener']('click',()=>{g_stat['cphNow']=0x0;}),g_elm_time_now=document[_0x45302b(0xd5)](_0x45302b(0xeb)),g_elm_total=document[_0x45302b(0xd5)](_0x45302b(0xcb)),g_elm_cph_past=document[_0x45302b(0xd5)](_0x45302b(0xea)),g_elm_cph_now=document[_0x45302b(0xd5)](_0x45302b(0xd3)),clearInterval(timerInit),setInterval(TimerStat,0x3e8);}}catch(_0x2bf575){console['warn'](_0x45302b(0xd7)+_0x2bf575[_0x45302b(0xed)]),clearInterval(timerInit);}},0x3e8);document[_0x5bfb4d(0xde)](_0x5bfb4d(0xdf),_0x2d8e01=>{const _0x48a7ee=_0x5bfb4d;try{const _0x380916=document[_0x48a7ee(0xe0)](_0x48a7ee(0xec));let _0x468b4b=_0x380916['length'];while(_0x468b4b--){const _0x373ceb=_0x380916[_0x468b4b];if(Boolean(_0x373ceb['textContent'][_0x48a7ee(0xbc)](_0x48a7ee(0xe5)))){if(_0x373ceb[_0x48a7ee(0xf2)](_0x2d8e01[_0x48a7ee(0xda)])){const _0x280bf8=document[_0x48a7ee(0xb8)]('#app\x20>\x20main\x20>\x20div\x20>\x20div:nth-child(2)');if(!Boolean(_0x280bf8))throw new Error(_0x48a7ee(0xc7));g_obs_job_close[_0x48a7ee(0xd1)](_0x280bf8,{'childList':!![]});break;}}}}catch(_0x13e304){console[_0x48a7ee(0xd0)]('Click:\x20'+_0x13e304[_0x48a7ee(0xed)]);}});function ObserveJobClose(){const _0x22adee=_0x5bfb4d;try{g_stat[_0x22adee(0xce)]();}catch(_0x1681b4){console[_0x22adee(0xd0)](_0x22adee(0xe6)+_0x1681b4[_0x22adee(0xed)]);}finally{g_obs_job_close['disconnect']();}}function LoadPrjStat(){const _0x49339a=_0x5bfb4d;let _0x303251=window[_0x49339a(0xb9)][_0x49339a(0xbe)][_0x49339a(0xbd)](/(?<=\/service-dataset-collector-frontend\/project\/)\d+/);if(!Boolean(_0x303251))return![];_0x303251=_0x303251[0x0];if(Boolean(g_stat)){if(_0x303251==g_stat[_0x49339a(0xf0)])return!![];let _0x1c1071=g_stat_list[_0x49339a(0xc0)];while(_0x1c1071--){if(g_stat_list[_0x1c1071]['prjName']==_0x303251)return g_stat=g_stat_list[_0x1c1071],!![];}}return g_stat=new PrjStat(_0x303251),g_stat_list[_0x49339a(0xd9)](g_stat),!![];}function TimerStat(){const _0x53fe3b=_0x5bfb4d;g_dt_now[_0x53fe3b(0xe2)](Date[_0x53fe3b(0xe3)]()),g_elm_time_now[_0x53fe3b(0xf1)]=g_dt_now[_0x53fe3b(0xcd)]();if(!LoadPrjStat()){g_elm_total['textContent']=g_elm_cph_past[_0x53fe3b(0xf1)]=g_elm_cph_now[_0x53fe3b(0xf1)]='?';return;}g_elm_total['textContent']=g_stat[_0x53fe3b(0xcb)],g_elm_cph_past['textContent']=g_stat[_0x53fe3b(0xe9)],g_elm_cph_now[_0x53fe3b(0xf1)]=g_stat['cphNow'];}
